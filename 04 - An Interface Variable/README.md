# An Interface Variable

Building on the previous exercise, we will now try to change the variable type from global to input.
`exercise.spvasm` contains a vertex shader, so this variable would be a vertex attribute.

As a reminder, please have [the SPIR-V specification][SPIRV-spec] handy.

[SPIRV-spec]: https://www.khronos.org/registry/spir-v/specs/unified1/SPIRV.html

## The Storage Class

Assuming the variable still has the `float` type, we can keep the `OpTypeFloat` instruction as is.
We used the `Private` storage class to declare a global variable.  We need to change that in both
the `OpTypePointer` and `OpVariable` instructions.

Take a look at `OpTypePointer` in the spec and click on _Storage Class_ (or just search for "storage
class").  Can you spot the storage class necessary to declare an input variable?  Great, let's use
that instead of `Private`.

Add this to the SPIR-V too, right after `OpName`:

```elisp
OpDecorate %7 Location 0
```

We'll get to `OpDecorate` in the next exercise.

How is the GLSL (through `./validate`) looking now?

## The Entry Point

The GLSL generated from the SPIR-V looks good now actually.  However, there's one modification
missing from the SPIR-V to actually make this input variable usable.  Recall that a SPIR-V file may
include multiple entry points (because multiple shaders could be bundled in one SPIR-V, possibly
sharing code).  Because of that, an input variable is not usable in the shader just by the virtue of
it being declared.

You can verify this by placing this instruction inside the function (right after the `OpLabel`
instruction):

```swift
%8 = OpLoad %5 %7
```

You can probably guess what this instruction does; it's reading the attribute.  Is `./validate`
happy now?

Note: `spirv-val` (the program used by `./validate` to validate the generated SPIR-V) is outputting
the error message partially specifying ids numerically, and partially by their autogenerated
"friendly names".  Since your source code is definitely using either one or the other, this is bound
to be confusing.  Try the following scripts to see your SPIR-V with numerical ids and friendly
names:

    $ ../scripts/id_to_names exercise.spvasm
    $ ../scripts/names_to_id exercise.spvasm

Back to the validation error, it's saying that the interface variable is used by the entry point (we
loaded from it in `main`), but it's not listed as an interface.  Look up `OpEntryPoint` in the
SPIR-V spec.  What do you see about interfaces?

> Waiting for you to consult the spec ...

This instruction takes a list of interface variables that this entry point accesses.  Add the
id of the variable to this instruction and `./validate` should work again:

```swift
     OpEntryPoint Vertex %3 "main" %7
```

Why does the load from this variable not show in the generated GLSL?  SPIR-V Cross is helpfully
dropping this as the load is pointless; the results are not used.
